<!DOCTYPE html>
<html>
  <head>
    <style>
      .container {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .image-container {
        position: relative;
        width: 800px;
        height: 600px;
        overflow: hidden;
        border: 1px solid #ccc;
      }

      .bitmap,
      .svg-container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform-origin: center center;
      }

      .svg-container {
        cursor: move;
      }

      .controls {
        margin-top: 10px;
      }

      .file-inputs input[type="file"] {
        display: none;
      }

      .file-inputs label,
      button {
        display: inline-block;
        padding: 10px 15px;
        background-color: #f0f0f0;
        border: 1px solid #ccc;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 10px;
      }

      .resize-handle {
        width: 10px;
        height: 10px;
        background-color: #007bff;
        position: absolute;
        border-radius: 50%;
      }

      .resize-handle.nw {
        top: -5px;
        left: -5px;
        cursor: nwse-resize;
      }
      .resize-handle.ne {
        top: -5px;
        right: -5px;
        cursor: nesw-resize;
      }
      .resize-handle.sw {
        bottom: -5px;
        left: -5px;
        cursor: nesw-resize;
      }
      .resize-handle.se {
        bottom: -5px;
        right: -5px;
        cursor: nwse-resize;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="file-inputs">
        <label for="bitmapFile">Load Bitmap</label>
        <input type="file" id="bitmapFile" accept="image/png" />
        <label for="svgFile">Load SVG</label>
        <input type="file" id="svgFile" accept="image/svg+xml" />
      </div>
      <div class="image-container">
        <img class="bitmap" src="" alt="Bitmap Image" />
        <div class="svg-container">
          <img class="svg" src="" alt="SVG Image" />
          <div class="resize-handle nw"></div>
          <div class="resize-handle ne"></div>
          <div class="resize-handle sw"></div>
          <div class="resize-handle se"></div>
        </div>
      </div>
      <div class="controls">
        <button id="zoomIn">Zoom In</button>
        <button id="zoomOut">Zoom Out</button>
        <button id="growSVG">Grow SVG</button>
        <button id="shrinkSVG">Shrink SVG</button>
      </div>
      <div id="colorInfo"></div>
    </div>

    <script>
      const bitmapFileInput = document.querySelector("#bitmapFile");
      const svgFileInput = document.querySelector("#svgFile");
      const bitmap = document.querySelector(".bitmap");
      const svgContainer = document.querySelector(".svg-container");
      const svg = document.querySelector(".svg");
      const colorInfo = document.getElementById("colorInfo");
      const imageContainer = document.querySelector(".image-container");

      let svgScale = 1;
      let svgX = 0;
      let svgY = 0;
      let zoom = 1;

      function loadImage(file, imgElement) {
        return new Promise((resolve) => {
          const reader = new FileReader();
          reader.onload = function (e) {
            imgElement.src = e.target.result;
            imgElement.onload = () => {
              imgElement.style.width = imgElement.naturalWidth + "px";
              imgElement.style.height = imgElement.naturalHeight + "px";
              resolve();
            };
          };
          reader.readAsDataURL(file);
        });
      }

      bitmapFileInput.addEventListener("change", async function () {
        await loadImage(this.files[0], bitmap);
        updateImagePositions();
      });

      svgFileInput.addEventListener("change", async function () {
        await loadImage(this.files[0], svg);
        updateImagePositions();
      });

      function updateImagePositions() {
        bitmap.style.transform = `translate(-50%, -50%) scale(${zoom})`;
        svgContainer.style.transform = `translate(calc(-50% + ${svgX}px), calc(-50% + ${svgY}px)) scale(${zoom})`;
        svg.style.transform = `scale(${svgScale})`;

        updateColorInfo();
      }

      function getColorAtPoint(x, y) {
        const canvas = document.createElement("canvas");
        const context = canvas.getContext("2d");
        canvas.width = bitmap.naturalWidth;
        canvas.height = bitmap.naturalHeight;
        context.drawImage(bitmap, 0, 0);
        const pixelData = context.getImageData(x, y, 1, 1).data;
        return `rgb(${pixelData[0]}, ${pixelData[1]}, ${pixelData[2]})`;
      }

      function updateColorInfo() {
        const svgRect = svgContainer.getBoundingClientRect();
        const bitmapRect = bitmap.getBoundingClientRect();

        const relativeX =
          (svgRect.left + svgRect.width / 2 - bitmapRect.left) / zoom;
        const relativeY =
          (svgRect.top + svgRect.height / 2 - bitmapRect.top) / zoom;

        const bitmapX = bitmap.naturalWidth / 2 + relativeX;
        const bitmapY = bitmap.naturalHeight / 2 + relativeY;

        const color = getColorAtPoint(bitmapX, bitmapY);
        colorInfo.textContent = `SVG center position: (${relativeX.toFixed(
          2
        )}, ${relativeY.toFixed(2)}), Color: ${color}`;
      }

      document.getElementById("zoomIn").addEventListener("click", () => {
        zoom *= 1.1;
        updateImagePositions();
      });

      document.getElementById("zoomOut").addEventListener("click", () => {
        zoom /= 1.1;
        updateImagePositions();
      });

      document.getElementById("growSVG").addEventListener("click", () => {
        svgScale *= 1.1;
        updateImagePositions();
      });

      document.getElementById("shrinkSVG").addEventListener("click", () => {
        svgScale /= 1.1;
        updateImagePositions();
      });

      // Update color info whenever the SVG moves or resizes
      svgContainer.addEventListener("transitionend", updateColorInfo);

      // Add event listener for window resize
      window.addEventListener("resize", updateImagePositions);

      // Move functionality
      let isDragging = false;
      let startX, startY;

      svgContainer.addEventListener("mousedown", (e) => {
        if (e.target === svg) {
          isDragging = true;
          startX = e.clientX - svgX;
          startY = e.clientY - svgY;
        }
      });

      document.addEventListener("mousemove", (e) => {
        if (isDragging) {
          svgX = e.clientX - startX;
          svgY = e.clientY - startY;
          updateImagePositions();
        }
      });

      document.addEventListener("mouseup", () => {
        isDragging = false;
      });

      // Resize functionality
      const resizeHandles = document.querySelectorAll(".resize-handle");
      let isResizing = false;
      let currentHandle;

      resizeHandles.forEach((handle) => {
        handle.addEventListener("mousedown", (e) => {
          isResizing = true;
          currentHandle = e.target;
          e.stopPropagation();
        });
      });

      document.addEventListener("mousemove", (e) => {
        if (isResizing) {
          const svgRect = svg.getBoundingClientRect();
          const containerRect = imageContainer.getBoundingClientRect();

          let newWidth, newHeight;

          if (
            currentHandle.classList.contains("se") ||
            currentHandle.classList.contains("ne")
          ) {
            newWidth = e.clientX - svgRect.left;
          } else {
            newWidth = svgRect.right - e.clientX;
            svgX += (svgRect.width - newWidth) / 2;
          }

          if (
            currentHandle.classList.contains("se") ||
            currentHandle.classList.contains("sw")
          ) {
            newHeight = e.clientY - svgRect.top;
          } else {
            newHeight = svgRect.bottom - e.clientY;
            svgY += (svgRect.height - newHeight) / 2;
          }

          const widthScale = newWidth / svg.naturalWidth;
          const heightScale = newHeight / svg.naturalHeight;
          svgScale = Math.min(widthScale, heightScale) / zoom;

          updateImagePositions();
        }
      });

      document.addEventListener("mouseup", () => {
        isResizing = false;
      });
    </script>
  </body>
</html>
